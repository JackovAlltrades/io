class Prototypes extends Array{constructor(e){super();let t=e.prototype;for(;t&&t.constructor!==HTMLElement&&t.constructor!==Object;)this.push(t),t=t.__proto__}}const illegalPropNames=["style","className","listeners"];class ProtoProperties{constructor(e){const t={};for(let s=e.length;s--;){let i=e[s].constructor.properties;for(let e in i){-1!==illegalPropNames.indexOf(e)&&console.warn("Illegal property name:",e);let s=new Property(i[e],!0);t[e]?t[e].assign(s):t[e]=s}}for(let e in t)this[e]=new Property(t[e])}clone(){let e=new ProtoProperties([]);for(let t in this)e[t]=this[t].clone();return e}}function defineProperties(e){for(let t in e.__props){const s=t+"Changed",i=t+"-changed",o="_"!==t.charAt(0),r=!(!1===e.__props[t].enumerable);Object.defineProperty(e,t,{get:function(){return this.__props[t].value},set:function(e){if(this.__props[t].value===e)return;const r=this.__props[t].value;this.__props[t].value=e,this.__props[t].reflect&&this.setAttribute(t,this.__props[t].value),o&&(this[s]&&this[s](e,r),this.__props[t].observer&&this[this.__props[t].observer](e,r),this.changed(),this.dispatchEvent(i,{property:t,value:e,oldValue:r}))},enumerable:r&&o,configurable:!0})}}class Property{constructor(e){null===e||void 0===e?e={value:e}:"function"==typeof e?e={type:e}:"object"!=typeof e&&(e={value:e,type:e.constructor}),this.value=e.value,this.type=e.type,this.observer=e.observer,this.reflect=e.reflect,this.binding=e.binding,this.config=e.config,this.enumerable=void 0===e.enumerable||e.enumerable}assign(e){void 0!==e.value&&(this.value=e.value),void 0!==e.type&&(this.type=e.type),void 0!==e.observer&&(this.observer=e.observer),void 0!==e.reflect&&(this.reflect=e.reflect),void 0!==e.binding&&(this.binding=e.binding),void 0!==e.config&&(this.config=e.config),void 0!==e.enumerable&&(this.enumerable=e.enumerable)}clone(){let e=new Property(this);return void 0===e.value&&e.type&&(e.type===Boolean?e.value=!1:e.type===String?e.value="":e.type===Number?e.value=0:e.type===Array?e.value=[]:e.type===Object?e.value={}:e.type!==HTMLElement&&e.type!==Function&&(e.value=new e.type)),e}}class ProtoListeners{constructor(e){for(let t=e.length;t--;){let s=e[t].constructor.listeners;for(let e in s)this[e]=s[e]}}connect(e){for(let t in this)e.addEventListener(t,e[this[t]])}disconnect(e){for(let t in this)e.removeEventListener(t,e[this[t]])}}class ProtoFunctions extends Array{constructor(e){super();for(let t=e.length;t--;){let s=Object.getOwnPropertyNames(e[t]);for(let i=0;i<s.length;i++)"constructor"!==s[i]&&"function"==typeof e[t][s[i]]&&"anonymous"!==e[t][s[i]].name&&(-1===this.indexOf(s[i])&&this.push(s[i]),"value"===s[i]&&console.log(e[t][s[i]]))}}bind(e){for(let t=0;t<this.length;t++)e[this[t]]=e[this[t]].bind(e)}}class Binding{constructor(e,t){this.source=e,this.sourceProp=t,this.targets=[],this.targetsMap=new WeakMap,this.updateSource=this.updateSource.bind(this),this.updateTargets=this.updateTargets.bind(this),this.setSource(this.source)}setSource(){this.source.addEventListener(this.sourceProp+"-changed",this.updateTargets);for(let e=this.targets.length;e--;){let t=this.targetsMap.get(this.targets[e]);for(let s=t.length;s--;)this.targets[e].__props[t[s]].value=this.source[this.sourceProp]}}setTarget(e,t){if(-1===this.targets.indexOf(e)&&this.targets.push(e),this.targetsMap.has(e)){let s=this.targetsMap.get(e);-1===s.indexOf(t)&&(s.push(t),e.addEventListener(t+"-changed",this.updateSource))}else this.targetsMap.set(e,[t]),e.addEventListener(t+"-changed",this.updateSource)}removeTarget(e,t){if(this.targetsMap.has(e)){let s=this.targetsMap.get(e),i=s.indexOf(t);-1!==i&&s.splice(i,1),0===s.length&&this.targets.splice(this.targets.indexOf(e),1),e.removeEventListener(t+"-changed",this.updateSource)}}updateSource(e){if(-1===this.targets.indexOf(e.target))return;let t=e.detail.value;this.source[this.sourceProp]!==t&&(this.source[this.sourceProp]=t)}updateTargets(e){if(e.target!=this.source)return;let t=e.detail.value;for(let e=this.targets.length;e--;){let s=this.targetsMap.get(this.targets[e]);for(let i=s.length;i--;){let o=this.targets[e][s[i]];if(o!==t){if("number"==typeof t&&"number"==typeof o&&isNaN(t)&&isNaN(o))continue;this.targets[e][s[i]]=t}}}}}class PropListeners{setListeners(e){for(let t in e)t.startsWith("on-")&&(this[t.slice(3,t.length)]=e[t])}connect(e){for(let t in this){let s="function"==typeof this[t]?this[t]:e[this[t]];e.addEventListener(t,s)}}disconnect(e){for(let t in this){let s="function"==typeof this[t]?this[t]:e[this[t]];e.removeEventListener(t,s)}}}const IoCore=e=>(class extends e{static get properties(){return{id:{type:String,enumerable:!1}}}constructor(e={}){super(),Object.defineProperty(this,"__bindings",{value:{}}),Object.defineProperty(this,"__listeners",{value:{}}),Object.defineProperty(this,"__observeQueue",{value:[]}),Object.defineProperty(this,"__notifyQueue",{value:[]}),Object.defineProperty(this,"__props",{value:this.__props.clone()}),Object.defineProperty(this,"$",{value:{}}),this.__protoFunctions.bind(this),Object.defineProperty(this,"__propListeners",{value:new PropListeners}),this.__propListeners.setListeners(e),this.setProperties(e),-1===this.__observeQueue.indexOf("changed")&&this.__observeQueue.push("changed")}changed(){}dispose(){this.__protoListeners.disconnect(this),this.__propListeners.disconnect(this),this.removeListeners();for(let e in this.__props)this.__props[e].binding&&(this.__props[e].binding.removeTarget(this,e),delete this.__props[e].binding)}bind(e){return this.__bindings[e]=this.__bindings[e]||new Binding(this,e),this.__bindings[e]}set(e,t){let s=this[e];this[e]=t,s!==t&&this.dispatchEvent(e+"-set",{value:t,oldValue:s},!1)}setProperties(e){for(let t in e){if(void 0===this.__props[t])continue;let s,i,o=this.__props[t].binding,r=this.__props[t].value;e[t]instanceof Binding?(s=e[t],i=e[t].source[e[t].sourceProp]):i=e[t],this.__props[t].binding=s,this.__props[t].value=i,i!==r&&(this.__props[t].reflect&&this.setAttribute(t,i),this.queue(this.__props[t].observer,t,i,r),this.__props[t].observer&&this.queue(this.__props[t].observer,t,i,r),this.queue(t+"Changed",t,i,r)),s!==o&&(s&&s.setTarget(this,t),o&&o.removeTarget(this,t))}if(e.className&&(this.className=e.className),e.style)for(let t in e.style)this.style[t]=e.style[t],this.style.setProperty(t,e.style[t])}objectMutated(e){for(let t=this.__objectProps.length;t--;)this.__props[this.__objectProps[t]].value===e.detail.object&&this.changed()}connectedCallback(){this.__protoListeners.connect(this),this.__propListeners.connect(this),this.queueDispatch();for(let e in this.__props)this.__props[e].binding&&this.__props[e].binding.setTarget(this,e);this.__objectProps.length&&window.addEventListener("io-object-mutated",this.objectMutated)}disconnectedCallback(){this.__protoListeners.disconnect(this),this.__propListeners.disconnect(this);for(let e in this.__props)this.__props[e].binding&&this.__props[e].binding.removeTarget(this,e);this.__objectProps.length&&window.removeEventListener("io-object-mutated",this.objectMutated)}addEventListener(t,s){this.__listeners[t]=this.__listeners[t]||[],-1===this.__listeners[t].indexOf(s)&&(e===HTMLElement&&HTMLElement.prototype.addEventListener.call(this,t,s),this.__listeners[t].push(s))}hasEventListener(e,t){return void 0!==this.__listeners[e]&&-1!==this.__listeners[e].indexOf(t)}removeEventListener(t,s){if(void 0!==this.__listeners[t]){let i=this.__listeners[t].indexOf(s);-1!==i&&(e===HTMLElement&&HTMLElement.prototype.removeEventListener.call(this,t,s),this.__listeners[t].splice(i,1))}}removeListeners(){for(let t in this.__listeners)for(let s=this.__listeners[t].length;s--;)e===HTMLElement&&HTMLElement.prototype.removeEventListener.call(this,t,this.__listeners[t][s]),this.__listeners[t].splice(s,1)}dispatchEvent(e,t={},s=!0,i=this){if(i instanceof HTMLElement||i===window)HTMLElement.prototype.dispatchEvent.call(i,new CustomEvent(e,{type:e,detail:t,bubbles:s,composed:!0}));else{let o=[i];if(void 0!==this.__listeners[e]){let i=this.__listeners[e].slice(0);for(let r=0,n=i.length;r<n;r++){const n={detail:t,target:this,bubbles:s,path:o=o||[this]};if(i[r].call(this,n),s){let s=this.parent;for(;s;)o.push(s),s.dispatchEvent(e,t,!0,o),s=s.parent}}}}}queue(e,t,s,i){"number"==typeof s&&"number"==typeof i&&isNaN(s)&&isNaN(i)||(e&&this[e]&&-1===this.__observeQueue.indexOf(e)&&this.__observeQueue.push(e),this.__notifyQueue.push([t+"-changed",{value:s,oldValue:i}]))}queueDispatch(){(this.__observeQueue.length||this.__notifyQueue.length)&&this.__observeQueue.push("changed");for(let e=0;e<this.__observeQueue.length;e++)this[this.__observeQueue[e]]();for(let e=0;e<this.__notifyQueue.length;e++)this.dispatchEvent(this.__notifyQueue[e][0],this.__notifyQueue[e][1]);this.__observeQueue.length=0,this.__notifyQueue.length=0}});IoCore.Register=function(){Object.defineProperty(this.prototype,"__prototypes",{value:new Prototypes(this)}),Object.defineProperty(this.prototype,"__props",{value:new ProtoProperties(this.prototype.__prototypes)}),Object.defineProperty(this.prototype,"__protoFunctions",{value:new ProtoFunctions(this.prototype.__prototypes)}),Object.defineProperty(this.prototype,"__protoListeners",{value:new ProtoListeners(this.prototype.__prototypes)}),Object.defineProperty(this.prototype,"__objectProps",{value:[]});const e=[Boolean,String,Number,HTMLElement,Function];for(let t in this.prototype.__props){let s=this.prototype.__props[t].type;-1==e.indexOf(s)&&this.prototype.__objectProps.push(t)}defineProperties(this.prototype)};class IoNode extends(IoCore(Object)){connect(){this.connectedCallback()}disconnect(){this.disconnectedCallback()}dispose(){delete this.parent,this.children.lenght=0;for(let e in this.__listeners)this.__listeners[e].lenght=0;for(let e in this.__props)delete this.__props[e]}}IoNode.Register=function(){IoCore.Register.call(this)},IoNode.Register();class IoElement extends(IoCore(HTMLElement)){static get properties(){return{tabindex:{type:String,reflect:!0,enumerable:!1},contenteditable:{type:Boolean,reflect:!0,enumerable:!1},title:{type:String,reflect:!0,enumerable:!1}}}connectedCallback(){super.connectedCallback();for(let e in this.__props)this.__props[e].reflect&&this.setAttribute(e,this.__props[e].value)}template(e,t){this.traverse(buildTree()(["root",e]).children,t||this)}traverse(e,t){const s=t.children;for(;s.length>e.length;){let e=s[s.length-1],i=Array.from(e.querySelectorAll("*"));for(let e=i.length;e--;)i[e].dispose&&i[e].dispose();t.removeChild(e)}const i=document.createDocumentFragment();for(let t=s.length;t<e.length;t++)i.appendChild(constructElement(e[t]));t.appendChild(i);for(let i=0;i<s.length;i++)if(s[i].localName!==e[i].name){const o=s[i];t.insertBefore(constructElement(e[i]),o),t.removeChild(o)}else if(s[i].hasOwnProperty("__props"))s[i].setProperties(e[i].props),s[i].queueDispatch(),s[i].__propListeners.setListeners(e[i].props),s[i].__propListeners.connect(s[i]);else{for(let t in e[i].props)if("style"===t)for(let o in e[i].props.style)s[i].style.setProperty(o,e[i].props[t][o]);else s[i][t]=e[i].props[t];s[i].__propListeners.setListeners(e[i].props),s[i].__propListeners.connect(s[i])}for(let t=0;t<e.length;t++)e[t].props.id&&(this.$[e[t].props.id]=s[t]),e[t].children&&"string"==typeof e[t].children?s[t].innerText=e[t].children:e[t].children&&"object"==typeof e[t].children&&this.traverse(e[t].children,s[t])}setAttribute(e,t){!0===t?HTMLElement.prototype.setAttribute.call(this,e,""):!1===t||""===t?this.removeAttribute(e):"string"!=typeof t&&"number"!=typeof t||this.getAttribute(e)!==String(t)&&HTMLElement.prototype.setAttribute.call(this,e,t)}static get observedAttributes(){return this.prototype.__observedAttributes}attributeChangedCallback(e,t,s){const i=this.__props[e].type;i===Boolean?null!==s&&""!==s||(this[e]=""===s):i&&(this[e]=i(s))}}function html(){return arguments[0][0]}IoElement.Register=function(){IoCore.Register.call(this);const e=this.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();Object.defineProperty(this,"localName",{value:e}),Object.defineProperty(this.prototype,"localName",{value:e}),Object.defineProperty(this.prototype,"__observedAttributes",{value:[]});for(let e in this.prototype.__props)this.prototype.__props[e].reflect&&this.prototype.__observedAttributes.push(e);customElements.define(e,this),initStyle(this.prototype.__prototypes)},IoElement.Register();const constructElement=function(e){let t=customElements.get(e.name);if(t)return new t(e.props);let s=document.createElement(e.name);for(let t in e.props)if("style"===t)for(let i in e.props[t])s.style[i]=e.props[t][i];else s[t]=e.props[t];return Object.defineProperty(s,"__propListeners",{value:new PropListeners}),s.__propListeners.setListeners(e.props),s.__propListeners.connect(s),s},clense=(e,t)=>t?"string"==typeof t[0]?[...e,t]:[...e,...t]:e,buildTree=()=>e=>e&&"object"==typeof e[1]&&!Array.isArray(e[1])?{name:e[0],props:e[1],children:Array.isArray(e[2])?e[2].reduce(clense,[]).map(buildTree()):e[2]||""}:buildTree()([e[0],{},e[1]||""]),_stagingElement=document.createElement("div");function initStyle(e){let t=e[0].constructor.name.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();for(let s=e.length;s--;){let i=e[s].constructor.style;if(i){if(s<e.length-1&&i==e[s+1].constructor.style)continue;i=i.replace(new RegExp(":host","g"),t),_stagingElement.innerHTML=i;let o=_stagingElement.querySelector("style");o.setAttribute("id","io-style-"+t+"-"+s),document.head.appendChild(o)}}}const nodes={};class StoreNode extends IoNode{static get properties(){return{key:String,value:void 0}}constructor(e){super(e);const t=localStorage.getItem(this.key);null!==t&&(this.value=JSON.parse(t))}valueChanged(){localStorage.setItem(this.key,this.value)}}function storage(e,t){let s=nodes[e];return s||(s=new StoreNode({key:e}),nodes[e]=s,s.connect(),s.binding=s.bind("value")),void 0===s.value&&void 0!==t&&(s.value=t),s.binding}StoreNode.Register();const _clickmask=document.createElement("div");_clickmask.style="position: fixed; top:0; left:0; bottom:0; right:0; z-index:2147483647;";let _mousedownPath=null;class Vector2{constructor(e={}){this.x=e.x||0,this.y=e.y||0}set(e){return this.x=e.x,this.y=e.y,this}sub(e){return this.x-=e.x,this.y-=e.y,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}distanceTo(e){let t=this.x-e.x,s=this.y-e.y;return Math.sqrt(t*t+s*s)}}class Pointer{constructor(e={}){this.position=new Vector2(e.position),this.previous=new Vector2(e.previous),this.movement=new Vector2(e.movement),this.distance=new Vector2(e.distance),this.start=new Vector2(e.start)}getClosest(e){let t=e[0];for(let s=1;s<e.length;s++)this.position.distanceTo(e[s].position)<this.position.distanceTo(t.position)&&(t=e[s]);return t}changed(e){this.previous.set(this.position),this.movement.set(e.position).sub(this.position),this.distance.set(e.position).sub(this.start),this.position.set(e.position)}}const IoInteractiveMixin=e=>(class extends e{static get properties(){return{pointers:Array,pointermode:"relative",cursor:"all-scroll"}}static get listeners(){return{mousedown:"_onMousedown",touchstart:"_onTouchstart",mousemove:"_onMousehover"}}constructor(e){super(e),this._clickmask=_clickmask}getPointers(e,t){let s=e.touches?e.touches:[e],i=[],o=this.getBoundingClientRect();for(let r=0;r<s.length;r++)if(s[r].target===e.target||void 0===e.touches){let e=new Vector2({x:s[r].clientX,y:s[r].clientY});"relative"===this.pointermode?(e.x-=o.left,e.y-=o.top):"viewport"===this.pointermode&&(e.x=(e.x-o.left)/o.width*2-1,e.y=(e.y-o.top)/o.height*2-1),void 0===this.pointers[r]&&(this.pointers[r]=new Pointer({start:e}));let n=new Pointer({position:e}),h=n.getClosest(this.pointers);t&&h.start.set(e),h.changed(n),i.push(h)}for(let e=this.pointers.length;e--;)-1===i.indexOf(this.pointers[e])&&this.pointers.splice(e,1)}_onMousedown(e){_mousedownPath=e.composedPath(),this.getPointers(e,!0),this._fire("io-pointer-start",e,this.pointers),window.addEventListener("mousemove",this._onMousemove),window.addEventListener("mouseup",this._onMouseup),window.addEventListener("blur",this._onMouseup),_clickmask.parentNode!==document.body&&(document.body.appendChild(_clickmask),_clickmask.style.setProperty("cursor",this.cursor))}_onMousemove(e){this.getPointers(e),this._fire("io-pointer-move",e,this.pointers,_mousedownPath)}_onMouseup(e){this.getPointers(e),this._fire("io-pointer-end",e,this.pointers,_mousedownPath),window.removeEventListener("mousemove",this._onMousemove),window.removeEventListener("mouseup",this._onMouseup),window.removeEventListener("blur",this._onMouseup),_clickmask.parentNode===document.body&&(document.body.removeChild(_clickmask),_clickmask.style.setProperty("cursor",null))}_onMousehover(e){this.getPointers(e),this._fire("io-pointer-hover",e,this.pointers)}_onTouchstart(e){this.getPointers(e,!0),this._fire("io-pointer-hover",e,this.pointers),this._fire("io-pointer-start",e,this.pointers),this.addEventListener("touchmove",this._onTouchmove),this.addEventListener("touchend",this._onTouchend)}_onTouchmove(e){this.getPointers(e),this._fire("io-pointer-move",e,this.pointers)}_onTouchend(e){this.removeEventListener("touchmove",this._onTouchmove),this.removeEventListener("touchend",this._onTouchend),this._fire("io-pointer-end",e,this.pointers)}_fire(e,t,s,i){i=i||t.composedPath(),this.dispatchEvent(e,{event:t,pointer:s,path:i},!1)}});class IoInteractive extends(IoInteractiveMixin(IoElement)){}IoInteractive.Register();export{IoCore,IoNode,IoElement,html,storage,IoInteractive,IoInteractiveMixin};