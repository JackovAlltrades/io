import{IoElement,html,IoThemeSingleton,IoGl,chunk}from"./io.js";class Item{constructor(t){"object"!=typeof t||void 0===t.options&&void 0===t.action&&void 0===t.value?this.value=t:Object.assign(this,t),void 0===this.label&&(this.value instanceof Array?this.label=String(`${this.value.constructor.name} (${this.value.length})`):"object"==typeof this.value?this.label=String(`${this.value.constructor.name}`):void 0!==this.value?this.label=String(this.value):console.warn("Option must have label or value!"))}}class IoItem extends IoElement{static get Style(){return html`<style>:host {${IoThemeSingleton.item};}:host {cursor: pointer;user-select: none;background-color: var(--io-background-color);color: var(--io-color);}:host:hover {background-color: var(--io-background-color-light);}:host:focus {text-overflow: inherit;border-color: var(--io-color-focus);outline: 0;}:host[aria-invalid] {text-decoration: underline;text-decoration-style: dashed;text-decoration-color: var(--io-color-error);border-color: var(--io-color-error);}:host[hidden] {display: none;}:host[selected] {color: var(--io-color-link);}</style>`}static get Attributes(){return{label:{notify:!0},hidden:Boolean,selected:Boolean,tabindex:0}}static get Properties(){return{value:void 0}}static get Listeners(){return{focus:"_onFocus"}}get textNode(){return this._flattenTextNode(),this._textNode.nodeValue}set textNode(t){this._flattenTextNode(),this._textNode.nodeValue!==String(t)&&(this._textNode.nodeValue=String(t))}_flattenTextNode(){if(0===this.childNodes.length&&this.appendChild(document.createTextNode("")),this._textNode=this.childNodes[0],this.childNodes.length>1){const t=this.textContent;for(let t=this.childNodes.length;t--;)0!==t&&this.removeChild(this.childNodes[t]);this._textNode.nodeValue=t}}constructor(t){super(t),this._textNode=document.createTextNode(""),this.appendChild(this._textNode)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("blur",this._onBlur),this.removeEventListener("keydown",this._onKeydown),this.removeEventListener("click",this._onClick)}_onFocus(){this.addEventListener("blur",this._onBlur),this.addEventListener("keydown",this._onKeydown),this.addEventListener("click",this._onClick)}_onBlur(){this.removeEventListener("blur",this._onBlur),this.removeEventListener("keydown",this._onKeydown),this.removeEventListener("click",this._onClick)}_onKeydown(t){13===t.which||32===t.which?(t.preventDefault(),this._onClick(t)):"ArrowLeft"===t.key?(t.preventDefault(),this.focusTo("left")):"ArrowUp"===t.key?(t.preventDefault(),this.focusTo("up")):"ArrowRight"===t.key?(t.preventDefault(),this.focusTo("right")):"ArrowDown"===t.key&&(t.preventDefault(),this.focusTo("down"))}_onClick(){this.dispatchEvent("item-clicked",{value:this.value,label:this.label},!0)}changed(){let t=String(this.value);this.value&&"object"==typeof this.value&&(t=`${this.value.constructor.name}`+(this.value instanceof Array?`(${this.value.length})`:"")),t=this.label||t,this.textNode=t,this.title=t}}IoItem.Register();class IoBoolean extends IoItem{static get Style(){return html`<style>:host {${IoThemeSingleton.button}}:host:not([value]) {opacity: 0.75;}</style>`}static get Attributes(){return{role:"switch"}}static get Properties(){return{value:{type:Boolean,reflect:1},true:"true",false:"false",role:"switch"}}_onClick(){this.toggle()}toggle(){this.set("value",!this.value)}valueChanged(){this.setAttribute("value",Boolean(this.value))}changed(){this.setAttribute("aria-checked",String(!!this.value)),this.setAttribute("aria-invalid","boolean"!=typeof this.value&&"true"),this.textNode=this.value?this.true:this.false}}IoBoolean.Register();class IoButton extends IoItem{static get Style(){return html`<style>:host {${IoThemeSingleton.button}}</style>`}static get Attributes(){return{label:"Button",role:"button"}}static get Properties(){return{action:Function,value:void 0}}_onClick(){"function"==typeof this.action&&this.action(this.value)}}IoButton.Register();class IoNumber extends IoItem{static get Style(){return html`<style>:host {${IoThemeSingleton.field}}</style>`}static get Attributes(){return{role:"textbox",type:"number",pattern:'pattern="[0-9]*"',inputmode:"numeric",contenteditable:!0,spellcheck:!1}}static get Properties(){return{value:Number,conversion:1,step:.001,min:-1/0,max:1/0,strict:!0}}_onFocus(t){super._onFocus(t),this._textContentOnFocus=this.textNode}_onBlur(t){super._onBlur(t),this._textContentOnFocus!==this.textNode&&this._setFromTextNode(),this.scrollTop=0,this.scrollLeft=0}_onKeydown(t){const e=window.getSelection().getRangeAt(0),o=e.startOffset,i=e.endOffset,s=this.childNodes[0]?this.childNodes[0].length:0,n=e.startContainer===e.endContainer&&(e.startContainer===this.childNodes[0]||e.startContainer===this);13==t.which?(t.preventDefault(),this._setFromTextNode()):37==t.which?n&&o===i&&0===o&&(t.preventDefault(),this.focusTo("left")):38==t.which?n&&o===i&&0===o&&(t.preventDefault(),this.focusTo("up")):39==t.which?n&&o===i&&o===s&&(t.preventDefault(),this.focusTo("right")):40==t.which&&n&&o===i&&o===s&&(t.preventDefault(),this.focusTo("down"))}_setFromTextNode(){let t=this.textNode,e=Math.round(Number(t)/this.step)*this.step/this.conversion;this.strict&&(e=Math.min(this.max,Math.max(this.min,e))),isNaN(e)?this.textNode="NaN":this.set("value",e)}changed(){let t,e=this.value;if("number"!=typeof e||isNaN(e))t="NaN";else{e*=this.conversion;let o=-Math.round(Math.log(this.step)/Math.LN10);o=Math.max(0,Math.min(100,o)),e=e.toFixed(o),t=Number(String(e))}this.textNode=t,this.setAttribute("aria-invalid",!("number"==typeof this.value&&!isNaN(this.value))&&"true")}}IoNumber.Register();class IoSlider extends IoElement{static get Style(){return html`<style>:host {display: flex;align-self: stretch;justify-self: stretch;}:host > io-number {flex: 0 0 auto;margin-right: var(--io-spacing);}:host > io-slider-knob {flex: 1 1 4.5em;}</style>`}static get Properties(){return{value:0,step:.001,min:0,max:1}}_onValueSet(t){this.value=t.detail.value,this.dispatchEvent("value-set",t.detail,!1)}changed(){this.template([["io-number",{id:"number",value:this.value,step:this.step,min:this.min,max:this.max,label:this.label,title:this.title,"on-value-set":this._onValueSet}],["io-slider-knob",{id:"slider",value:this.value,step:this.step,min:this.min,max:this.max,label:this.label,title:this.title,"on-value-set":this._onValueSet}]])}}class IoSliderKnob extends IoGl{static get Style(){return html`<style>:host {cursor: ew-resize;border: var(--io-inset-border);border-radius: var(--io-border-radius);border-color: var(--io-inset-border-color);min-height: 1.2em;align-self: stretch;justify-self: stretch}:host[aria-invalid] {outline: 1px solid var(--io-color-focus);}:host:focus {outline: 1px solid var(--io-color-focus);}</style>`}static get Attributes(){return{role:"slider",tabindex:0}}static get Properties(){return{value:0,step:.01,min:0,max:1e3}}static get Listeners(){return{touchstart:"_onTouchstart",mousedown:"_onMousedown",keydown:"_onKeydown"}}_onTouchstart(t){this.addEventListener("touchmove",this._onTouchmove),this.addEventListener("touchend",this._onTouchend),this._onPointerdown(t)}_onTouchmove(t){this._onPointermove(t)}_onTouchend(){this.removeEventListener("touchmove",this._onTouchmove),this.removeEventListener("touchend",this._onTouchend)}_onMousedown(t){t.preventDefault(),this.focus(),window.addEventListener("mousemove",this._onMousemove),window.addEventListener("mouseup",this._onMouseup),this._onPointerdown(t)}_onMousemove(t){this._onPointermove(t)}_onMouseup(){window.removeEventListener("mousemove",this._onMousemove),window.removeEventListener("mouseup",this._onMouseup)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("mousemove",this._onMousemove),window.removeEventListener("mouseup",this._onMouseup)}_onPointerdown(t){const e=t.changedTouches?t.changedTouches[0]:t;this._x=e.clientX,this._y=e.clientY,this._active=-1}_onPointermove(t){const e=t.changedTouches?t.changedTouches[0]:t,o=Math.abs(this._x-e.clientX),i=Math.abs(this._y-e.clientY);if(-1===this._active&&o>5&&(this._active=o>i&&i<20?1:0),1!==this._active)return;if(!t.cancelable)return;t.preventDefault(),this.focus();const s=this.getBoundingClientRect(),n=(e.clientX-s.x)/s.width,r=Math.max(0,Math.min(1,n));let a=(this.max-this.min)*r;a=this.min+Math.round(a/this.step)*this.step,a=Math.min(this.max,Math.max(this.min,a));let l=-Math.round(Math.log(this.step)/Math.LN10);l=Math.max(0,Math.min(100,l)),a=Number(a.toFixed(l)),this.set("value",a)}_onKeydown(t){37==t.which?(t.preventDefault(),t.shiftKey?this._moveSliderByKey("decrease"):this.focusTo("left")):38==t.which?(t.preventDefault(),t.shiftKey?this._moveSliderByKey("decrease"):this.focusTo("up")):39==t.which?(t.preventDefault(),t.shiftKey?this._moveSliderByKey("increase"):this.focusTo("right")):40==t.which?(t.preventDefault(),t.shiftKey?this._moveSliderByKey("increase"):this.focusTo("down")):33==t.which?(t.preventDefault(),this._moveSliderByKey("increase")):34==t.which?(t.preventDefault(),this._moveSliderByKey("decrease")):36==t.which?(t.preventDefault(),this._moveSliderByKey("min")):35==t.which&&(t.preventDefault(),this._moveSliderByKey("max"))}_moveSliderByKey(t){let e=this.value;switch(t){case"increase":e+=this.step;break;case"decrease":e-=this.step;break;case"min":e=this.min;break;case"max":e=this.max}e=Math.min(this.max,Math.max(this.min,e));let o=-Math.round(Math.log(this.step)/Math.LN10);o=Math.max(0,Math.min(100,o)),e=Number(e.toFixed(o)),this.set("value",e)}changed(){super.changed(),this.setAttribute("aria-invalid",!!isNaN(this.value)&&"true"),this.setAttribute("aria-valuenow",isNaN(this.value)?0:this.value),this.setAttribute("aria-valuemin",this.min),this.setAttribute("aria-valuemax",this.max)}static get Frag(){return`\n    #extension GL_OES_standard_derivatives : enable\n\n    ${chunk.translate}\n    ${chunk.circle}\n    ${chunk.grid}\n\n    varying vec2 vUv;\n\n    void main(void) {\n      vec2 position = vUv * uSize;\n\n      vec4 finalColor = cssBackgroundColorField;\n      vec4 slotColorBg = mix(cssColor, cssBackgroundColorField, 0.5);\n      vec4 stepColorBg = mix(slotColorBg, cssBackgroundColorField, 0.75);\n      vec4 slotColor = mix(cssColorFocus, cssColorLink, vUv.x);\n\n      float lineWidth = cssBorderWidth;\n      float slotWidth = cssBorderWidth;\n\n      float stepInPx = uSize.x / ((uMax - uMin) / uStep);\n\n      if (stepInPx > lineWidth * 2.0) {\n        float gridWidth = uSize.x / ((uMax - uMin) / uStep);\n        float gridOffset = mod(uMin, uStep) / (uMax - uMin) * uSize.x;\n        float gridShape = grid(translate(position, - gridOffset, 0.0), gridWidth, uSize.y, lineWidth);\n        finalColor = mix(stepColorBg, finalColor, gridShape);\n      }\n\n      float valueInRange = (uValue - uMin) / (uMax - uMin);\n      float valueField = saturate((vUv.x - valueInRange) * uSize.x);\n      float slotField = saturate((abs(0.5 - vUv.y)) * uSize.y - slotWidth);\n\n      finalColor = mix(mix(slotColor, slotColorBg, valueField), finalColor, slotField);\n\n      float circleShape = circle(translate(position, valueInRange * uSize.x, 0.5 * uSize.y), uSize.y / 4.0);\n      finalColor = mix(slotColor, finalColor, circleShape);\n\n      gl_FragColor = finalColor;\n    }`}}IoSliderKnob.Register(),IoSlider.Register();class IoString extends IoItem{static get Style(){return html`<style>:host {${IoThemeSingleton.field}}</style>`}static get Attributes(){return{role:"textbox",contenteditable:!0}}static get Properties(){return{value:String}}_setFromTextNode(){const t=this.textNode;"string"!=typeof this.value&&t===String(this.value)||this.set("value",t)}_onBlur(t){super._onBlur(t),this.removeEventListener("blur",this._onBlur),this.removeEventListener("keydown",this._onKeydown),this._setFromTextNode(),this.scrollTop=0,this.scrollLeft=0}_onKeydown(t){const e=window.getSelection().getRangeAt(0),o=e.startOffset,i=e.endOffset,s=this.childNodes[0]?this.childNodes[0].length:0,n=e.startContainer===e.endContainer&&(e.startContainer===this.childNodes[0]||e.startContainer===this);13==t.which?(t.preventDefault(),this._setFromTextNode()):37==t.which?n&&o===i&&0===o&&(t.preventDefault(),this.focusTo("left")):38==t.which?n&&o===i&&0===o&&(t.preventDefault(),this.focusTo("up")):39==t.which?n&&o===i&&o===s&&(t.preventDefault(),this.focusTo("right")):40==t.which&&n&&o===i&&o===s&&(t.preventDefault(),this.focusTo("down"))}changed(){this.textNode=String(this.value).replace(new RegExp(" ","g")," "),this.setAttribute("aria-invalid","string"!=typeof this.value&&"true")}}IoString.Register();class IoSwitch extends IoButton{static get Style(){return html`<style>:host {--io-switch-size: 1.375em;text-align: center;position: relative;border: var(--io-inset-border);border-color: var(--io-inset-border-color);color: var(--io-color-field);background-image: none;background-color: var(--io-background-color-dark);box-shadow: var(--io-shadow-inset);padding: 0;margin: var(--io-spacing);width: 3.5em;height: 1.375em;height: var(--io-switch-size);border-radius: var(--io-switch-size);transition: background-color 0.4s;}:host:focus {outline: none;border-color: var(--io-color-focus);}:host:hover,:host[value] {background-color: var(--io-background-color);}:host:not([value]) {opacity: 0.75;}:host:after {display: inline-block;position: absolute;content: '';top: 0;left: 0;height: calc(var(--io-switch-size) - calc(2 * var(--io-border-width)));width: calc(var(--io-switch-size) - calc(2 * var(--io-border-width)));background-color: var(--io-background-color-dark);border: var(--io-outset-border);border-color: var(--io-outset-border-color);border-radius: var(--io-switch-size);transition-timing-function: ease-in-out;transition: left 0.25s;}:host[value]:after {background-color: rgba(80, 210, 355, 0.75);left: calc(100% - var(--io-switch-size));}:host[aria-invalid] > div:after {background-color: var(--io-color-error);}</style>`}static get Attributes(){return{role:"switch"}}static get Properties(){return{value:{type:Boolean,reflect:1}}}constructor(t){super(t),this.__properties.action.value=this.toggle}toggle(){this.set("value",!this.value)}changed(){this.setAttribute("aria-checked",String(this.value)),this.setAttribute("aria-invalid","boolean"!=typeof this.value&&"true")}}IoSwitch.Register();export{IoBoolean,IoButton,IoItem,IoNumber,IoSlider,IoString,IoSwitch,Item};