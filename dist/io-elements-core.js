import{IoElement,html,IoThemeMixinSingleton,IoGl}from"./io.js";class Item{constructor(e){"object"!=typeof e||void 0===e.options&&void 0===e.action&&void 0===e.value?this.value=e:Object.assign(this,e),void 0===this.label&&(this.value instanceof Array?this.label=String(`${this.value.constructor.name} (${this.value.length})`):"object"==typeof this.value?this.label=String(`${this.value.constructor.name}`):void 0!==this.value?this.label=String(this.value):console.warn("Option must have label or value!"))}}class IoItem extends IoElement{static get Style(){return html`<style>:host {${IoThemeMixinSingleton.item};}:host {cursor: pointer;user-select: none;background-color: var(--io-background-color);color: var(--io-color);}:host:hover {background-color: var(--io-background-color-light);}:host:focus {text-overflow: inherit;border-color: var(--io-color-focus);outline: 0;}:host[aria-invalid] {text-decoration: underline;text-decoration-style: dashed;text-decoration-color: var(--io-color-error);border-color: var(--io-color-error);}:host[hidden] {display: none;}:host[selected] {color: var(--io-color-link);}</style>`}static get Attributes(){return{label:{notify:!0},hidden:Boolean,selected:Boolean,tabindex:0}}static get Properties(){return{value:void 0}}static get Listeners(){return{focus:"_onFocus"}}get textNode(){return this._flattenTextNode(),this._textNode.nodeValue}set textNode(e){this._flattenTextNode(),this._textNode.nodeValue!==String(e)&&(this._textNode.nodeValue=String(e))}_flattenTextNode(){if(0===this.childNodes.length&&this.appendChild(document.createTextNode("")),this._textNode=this.childNodes[0],this.childNodes.length>1){const e=this.textContent;for(let e=this.childNodes.length;e--;)0!==e&&this.removeChild(this.childNodes[e]);this._textNode.nodeValue=e}}constructor(e){super(e),this._textNode=document.createTextNode(""),this.appendChild(this._textNode)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("blur",this._onBlur),this.removeEventListener("keydown",this._onKeydown),this.removeEventListener("click",this._onClick)}_onFocus(){this.addEventListener("blur",this._onBlur),this.addEventListener("keydown",this._onKeydown),this.addEventListener("click",this._onClick)}_onBlur(){this.removeEventListener("blur",this._onBlur),this.removeEventListener("keydown",this._onKeydown),this.removeEventListener("click",this._onClick)}_onKeydown(e){13===e.which||32===e.which?(e.preventDefault(),this._onClick(e)):"ArrowLeft"===e.key?(e.preventDefault(),this.focusTo("left")):"ArrowUp"===e.key?(e.preventDefault(),this.focusTo("up")):"ArrowRight"===e.key?(e.preventDefault(),this.focusTo("right")):"ArrowDown"===e.key&&(e.preventDefault(),this.focusTo("down"))}_onClick(){this.dispatchEvent("item-clicked",{value:this.value,label:this.label},!0)}changed(){let e=String(this.value);this.value&&"object"==typeof this.value&&(e=`${this.value.constructor.name}`+(this.value instanceof Array?`(${this.value.length})`:"")),e=this.label||e,this.textNode=e,this.title=e}}IoItem.Register();class IoBoolean extends IoItem{static get Style(){return html`<style>:host {${IoThemeMixinSingleton.button}}:host:not([value]) {opacity: 0.75;}</style>`}static get Attributes(){return{role:"switch"}}static get Properties(){return{value:{type:Boolean,reflect:1},true:"true",false:"false",role:"switch"}}_onClick(){this.toggle()}toggle(){this.set("value",!this.value)}valueChanged(){this.setAttribute("value",Boolean(this.value))}changed(){this.setAttribute("aria-checked",String(!!this.value)),this.setAttribute("aria-invalid","boolean"!=typeof this.value&&"true"),this.textNode=this.value?this.true:this.false}}IoBoolean.Register();class IoButton extends IoItem{static get Style(){return html`<style>:host {${IoThemeMixinSingleton.button}}</style>`}static get Attributes(){return{label:"Button",role:"button"}}static get Properties(){return{action:Function,value:void 0}}_onClick(){"function"==typeof this.action&&this.action(this.value)}}IoButton.Register();class IoNumber extends IoItem{static get Style(){return html`<style>:host {${IoThemeMixinSingleton.field}}</style>`}static get Attributes(){return{role:"textbox",type:"number",pattern:'pattern="[0-9]*"',inputmode:"numeric",contenteditable:!0,spellcheck:!1}}static get Properties(){return{value:Number,conversion:1,step:.001,min:-1/0,max:1/0,strict:!0}}_onFocus(e){super._onFocus(e),this._textContentOnFocus=this.textNode}_onBlur(e){super._onBlur(e),this._textContentOnFocus!==this.textNode&&this._setFromTextNode(),this.scrollTop=0,this.scrollLeft=0}_onKeydown(e){const t=window.getSelection().getRangeAt(0),o=t.startOffset,i=t.endOffset,s=this.childNodes[0]?this.childNodes[0].length:0,n=t.startContainer===t.endContainer&&(t.startContainer===this.childNodes[0]||t.startContainer===this);13==e.which?(e.preventDefault(),this._setFromTextNode()):37==e.which?n&&o===i&&0===o&&(e.preventDefault(),this.focusTo("left")):38==e.which?n&&o===i&&0===o&&(e.preventDefault(),this.focusTo("up")):39==e.which?n&&o===i&&o===s&&(e.preventDefault(),this.focusTo("right")):40==e.which&&n&&o===i&&o===s&&(e.preventDefault(),this.focusTo("down"))}_setFromTextNode(){let e=this.textNode,t=Math.round(Number(e)/this.step)*this.step/this.conversion;this.strict&&(t=Math.min(this.max,Math.max(this.min,t))),isNaN(t)?this.textNode="NaN":this.set("value",t)}changed(){let e,t=this.value;if("number"!=typeof t||isNaN(t))e="NaN";else{t*=this.conversion;let o=-Math.round(Math.log(this.step)/Math.LN10);o=Math.max(0,Math.min(100,o)),t=t.toFixed(o),e=Number(String(t))}this.textNode=e,this.setAttribute("aria-invalid",!("number"==typeof this.value&&!isNaN(this.value))&&"true")}}IoNumber.Register();class IoSlider extends IoElement{static get Style(){return html`<style>:host {display: flex;align-self: stretch;justify-self: stretch;}:host > io-number {flex: 0 0 auto;margin-right: var(--io-spacing);}:host > io-slider-knob {flex: 1 1 4.5em;}</style>`}static get Properties(){return{value:0,step:.001,min:0,max:1}}_onValueSet(e){this.value=e.detail.value,this.dispatchEvent("value-set",e.detail,!1)}changed(){this.template([["io-number",{id:"number",value:this.value,step:this.step,min:this.min,max:this.max,label:this.label,title:this.title,"on-value-set":this._onValueSet}],["io-slider-knob",{id:"slider",value:this.value,step:this.step,minValue:this.min,maxValue:this.max,label:this.label,title:this.title,"on-value-set":this._onValueSet}]])}}class IoSliderKnob extends IoGl{static get Style(){return html`<style>:host {cursor: ew-resize;border: var(--io-inset-border);border-radius: var(--io-border-radius);border-color: var(--io-inset-border-color);min-height: 1.2em;align-self: stretch;justify-self: stretch}:host[aria-invalid] {outline: 1px solid var(--io-color-focus);}:host:focus {outline: 1px solid var(--io-color-focus);}</style>`}static get Attributes(){return{role:"slider",tabindex:0}}static get Properties(){return{value:0,step:.01,minValue:0,maxValue:1e3}}static get Listeners(){return{touchstart:"_onTouchstart",mousedown:"_onMousedown",keydown:"_onKeydown"}}_onTouchstart(e){this.addEventListener("touchmove",this._onTouchmove),this.addEventListener("touchend",this._onTouchend),this._onPointerdown(e)}_onTouchmove(e){this._onPointermove(e)}_onTouchend(){this.removeEventListener("touchmove",this._onTouchmove),this.removeEventListener("touchend",this._onTouchend)}_onMousedown(e){e.preventDefault(),this.focus(),window.addEventListener("mousemove",this._onMousemove),window.addEventListener("mouseup",this._onMouseup),this._onPointerdown(e)}_onMousemove(e){this._onPointermove(e)}_onMouseup(){window.removeEventListener("mousemove",this._onMousemove),window.removeEventListener("mouseup",this._onMouseup)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("mousemove",this._onMousemove),window.removeEventListener("mouseup",this._onMouseup)}_onPointerdown(e){const t=e.changedTouches?e.changedTouches[0]:e;this._x=t.clientX,this._y=t.clientY,this._active=-1}_onPointermove(e){const t=e.changedTouches?e.changedTouches[0]:e,o=Math.abs(this._x-t.clientX),i=Math.abs(this._y-t.clientY);if(-1===this._active&&o>5&&(this._active=o>i&&i<20?1:0),1!==this._active)return;if(!e.cancelable)return;e.preventDefault(),this.focus();const s=this.getBoundingClientRect(),n=(t.clientX-s.x)/s.width,r=Math.max(0,Math.min(1,n));let a=(this.maxValue-this.minValue)*r;a=this.minValue+Math.round(a/this.step)*this.step,a=Math.min(this.maxValue,Math.max(this.minValue,a));let l=-Math.round(Math.log(this.step)/Math.LN10);l=Math.max(0,Math.min(100,l)),a=Number(a.toFixed(l)),this.set("value",a)}_onKeydown(e){37==e.which?(e.preventDefault(),e.shiftKey?this._moveSliderByKey("decrease"):this.focusTo("left")):38==e.which?(e.preventDefault(),e.shiftKey?this._moveSliderByKey("decrease"):this.focusTo("up")):39==e.which?(e.preventDefault(),e.shiftKey?this._moveSliderByKey("increase"):this.focusTo("right")):40==e.which?(e.preventDefault(),e.shiftKey?this._moveSliderByKey("increase"):this.focusTo("down")):33==e.which?(e.preventDefault(),this._moveSliderByKey("increase")):34==e.which?(e.preventDefault(),this._moveSliderByKey("decrease")):36==e.which?(e.preventDefault(),this._moveSliderByKey("min")):35==e.which&&(e.preventDefault(),this._moveSliderByKey("max"))}_moveSliderByKey(e){let t=this.value;switch(e){case"increase":t+=this.step;break;case"decrease":t-=this.step;break;case"min":t=this.minValue;break;case"max":t=this.maxValue}t=Math.min(this.maxValue,Math.max(this.minValue,t));let o=-Math.round(Math.log(this.step)/Math.LN10);o=Math.max(0,Math.min(100,o)),t=Number(t.toFixed(o)),this.set("value",t)}changed(){super.changed(),this.setAttribute("aria-invalid",!!isNaN(this.value)&&"true"),this.setAttribute("aria-valuenow",isNaN(this.value)?0:this.value),this.setAttribute("aria-valuemin",this.minValue),this.setAttribute("aria-valuemax",this.maxValue)}static get Frag(){return"\n    #extension GL_OES_standard_derivatives : enable\n\n    varying vec2 vUv;\n\n    void main(void) {\n\n      vec4 finalColor = gBackground;\n\n      float _range = uMaxValue - uMinValue;\n      float _progress = (uValue - uMinValue) / _range;\n      float _value = mix(uMinValue, uMaxValue, vUv.x);\n      float _stepRange = uSize.x / (_range / uStep);\n\n      if (_stepRange > gLineWidth * 2.0) {\n        float res = _value / uStep;\n        float line = abs(fract(res - 0.5) - 0.5) / abs(dFdx(res)) / gLineWidth;\n        if (line < 0.999) line = 0.0;\n        finalColor = mix(finalColor, gColor, 1.0 - min(line, 1.0));\n      }\n\n      float slot = (abs(0.5 - vUv.y)) * uSize.y;\n      slot = (1.0 - slot) + gLineWidth * 2.0;\n      slot = clamp(slot, 0.0, 1.0);\n      vec4 slotColor = mix(gColorFocus, gColorLink, vUv.x);\n      float progress = (vUv.x - _progress) * uSize.x;\n      progress = clamp(progress, 0.0, 1.0);\n      slotColor = mix(slotColor, mix(gColor, gBackground, 0.5), progress);\n\n      float handle = abs(vUv.x - _progress) * uSize.x;\n      handle = (1.0 - handle) + gLineWidth * 2.0;\n      handle = clamp(handle, 0.0, 1.0);\n\n      finalColor = mix(finalColor, slotColor, slot);\n      finalColor = mix(finalColor, mix(gColorFocus, gColorLink, _progress), handle);\n      gl_FragColor = finalColor;\n    }"}}IoSliderKnob.Register(),IoSlider.Register();class IoString extends IoItem{static get Style(){return html`<style>:host {${IoThemeMixinSingleton.field}}</style>`}static get Attributes(){return{role:"textbox",contenteditable:!0}}static get Properties(){return{value:String}}_setFromTextNode(){const e=this.textNode;"string"!=typeof this.value&&e===String(this.value)||this.set("value",e)}_onBlur(e){super._onBlur(e),this.removeEventListener("blur",this._onBlur),this.removeEventListener("keydown",this._onKeydown),this._setFromTextNode(),this.scrollTop=0,this.scrollLeft=0}_onKeydown(e){const t=window.getSelection().getRangeAt(0),o=t.startOffset,i=t.endOffset,s=this.childNodes[0]?this.childNodes[0].length:0,n=t.startContainer===t.endContainer&&(t.startContainer===this.childNodes[0]||t.startContainer===this);13==e.which?(e.preventDefault(),this._setFromTextNode()):37==e.which?n&&o===i&&0===o&&(e.preventDefault(),this.focusTo("left")):38==e.which?n&&o===i&&0===o&&(e.preventDefault(),this.focusTo("up")):39==e.which?n&&o===i&&o===s&&(e.preventDefault(),this.focusTo("right")):40==e.which&&n&&o===i&&o===s&&(e.preventDefault(),this.focusTo("down"))}changed(){this.textNode=String(this.value).replace(new RegExp(" ","g")," "),this.setAttribute("aria-invalid","string"!=typeof this.value&&"true")}}IoString.Register();class IoSwitch extends IoButton{static get Style(){return html`<style>:host {--io-switch-size: 1.375em;text-align: center;position: relative;border: var(--io-inset-border);border-color: var(--io-inset-border-color);color: var(--io-color-field);background-image: none;background-color: var(--io-background-color-dark);box-shadow: var(--io-shadow-inset);padding: 0;margin: var(--io-spacing);width: 3.5em;height: 1.375em;height: var(--io-switch-size);border-radius: var(--io-switch-size);transition: background-color 0.4s;}:host:focus {outline: none;border-color: var(--io-color-focus);}:host:hover,:host[value] {background-color: var(--io-background-color);}:host:not([value]) {opacity: 0.75;}:host:after {display: inline-block;position: absolute;content: '';top: 0;left: 0;height: calc(var(--io-switch-size) - calc(2 * var(--io-border-width)));width: calc(var(--io-switch-size) - calc(2 * var(--io-border-width)));background-color: var(--io-background-color-dark);border: var(--io-outset-border);border-color: var(--io-outset-border-color);border-radius: var(--io-switch-size);transition-timing-function: ease-in-out;transition: left 0.25s;}:host[value]:after {background-color: rgba(80, 210, 355, 0.75);left: calc(100% - var(--io-switch-size));}:host[aria-invalid] > div:after {background-color: var(--io-color-error);}</style>`}static get Attributes(){return{role:"switch"}}static get Properties(){return{value:{type:Boolean,reflect:1}}}constructor(e){super(e),this.__properties.action.value=this.toggle}toggle(){this.set("value",!this.value)}changed(){this.setAttribute("aria-checked",String(this.value)),this.setAttribute("aria-invalid","boolean"!=typeof this.value&&"true")}}IoSwitch.Register();export{IoBoolean,IoButton,IoItem,IoNumber,IoSlider,IoString,IoSwitch,Item};