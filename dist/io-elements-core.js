import{IoElement,html,IoNode,IoGl}from"./io.js";class IoThemeMixin extends IoNode{static get Style(){return html`<style>item {cursor: default;display: inline-block;-webkit-tap-highlight-color: transparent;overflow: hidden;text-overflow: ellipsis;flex-wrap: nowrap;white-space: nowrap;height: 1.375em;border: var(--io-inset-border);border-radius: var(--io-border-radius);border-color: transparent;background-color: transparent;background-image: none;padding: var(--io-spacing);}button {background-color: var(--io-background-color-dark);background-image: var(--io-gradient-button);border: var(--io-outset-border);border-color: var(--io-outset-border-color);border-radius: var(--io-border-radius);padding: var(--io-spacing);padding-left: calc(2 * var(--io-spacing));padding-right: calc(2 * var(--io-spacing));transition: background-color 0.25s;}field {border: var(--io-inset-border);border-radius: var(--io-border-radius);color: var(--io-color-field);background-color: var(--io-background-color-field);background-image: none;box-shadow: var(--io-shadow-inset);padding: var(--io-spacing);user-select: text;width: 4.5em;height: 1.375em;min-width: 0.5em;}panel {display: flex;flex-direction: column;align-self: stretch;justify-self: stretch;align-items: flex-start;border: var(--io-outset-border);border-radius: var(--io-border-radius);border-color: var(--io-outset-border-color);padding: var(--io-spacing);background: var(--io-background-color-dark);background-image: var(--io-gradient-panel);}frame {display: flex;flex-direction: column;align-self: stretch;justify-self: stretch;align-items: flex-start;border: var(--io-inset-border);border-radius: var(--io-border-radius);color: var(--io-color);background-color: var(--io-background-color);background-image: none;box-shadow: var(--io-shadow-inset);padding: var(--io-spacing);}content {display: flex;flex-direction: column;flex: 1 1 auto;overflow-x: hidden;overflow-y: auto;-webkit-overflow-scrolling: touch;-webkit-tap-highlight-color: transparent;}</style>`}constructor(e){super(e),this.styleElement=document.createElement("style"),this.styleElement.setAttribute("id","io-theme-mixins"),this.styleElement.innerHTML=this.mixins,document.head.appendChild(this.styleElement)}}IoThemeMixin.Register=function(){IoNode.Register.call(this);let e="";for(let t=this.prototype.__protochain.length;t--;){const o=this.prototype.__protochain[t].constructor.Style;if(o){const t=Array.from(o.string.matchAll(new RegExp(/([\s\S]*?){([\s\S]*?)}/,"g")));for(let o=0;o<t.length;o++){const i=t[o][1].replace(/\s/g,""),r=t[o][2];Object.defineProperty(this.prototype,i,{value:r}),e+=`.io-${i} {\n${r}\n}\n`}}}Object.defineProperty(this.prototype,"mixins",{value:e})},IoThemeMixin.Register();const IoThemeMixinSingleton=new IoThemeMixin;class IoTheme extends IoElement{static get Style(){return html`<style>body {--io-spacing: 4px;--io-border-radius: 3px;--io-border-width: 1px;}@keyframes spinner {to {transform: rotate(360deg);}}.io-loading {background-image: repeating-linear-gradient(135deg,var(--io-background-color-light),var(--io-background-color) 3px,var(--io-background-color) 7px,var(--io-background-color-light) 10px) !important;background-repeat: repeat;position: relative;}.io-loading:after {content: '';box-sizing: border-box;position: absolute;top: 50%;left: 50%;width: 40px;height: 40px;margin-top: -20px;margin-left: -20px;border-radius: 50%;border: var(--io-border);border-top-color: #000;animation: spinner .6s linear infinite;}</style>`}get dark(){return html`<style>body {--io-background-color: rgb(42, 42, 42);--io-background-color-light: rgb(56, 56, 56);--io-background-color-dark: rgb(64, 64, 64);--io-background-color-field: rgb(35, 35, 35);--io-color: rgb(210, 210, 210);--io-color-error: rgb(255, 96, 16);--io-color-link: rgb(190, 230, 150);--io-color-focus: rgb(80, 210, 355);--io-color-field: rgb(190, 190, 190);--io-color-number: rgb(32, 164, 255);--io-color-string: rgb(240, 64, 22);--io-color-boolean: rgb(210, 90, 190);--io-gradient-button: linear-gradient(0deg, rgba(0, 0, 0, 0.25), transparent 50%), linear-gradient(180deg, rgba(255, 255, 255, 0.075), transparent 50%);--io-gradient-panel: linear-gradient(100deg, rgba(0, 0, 0, 0.25), transparent 50%), linear-gradient(280deg, rgba(255, 255, 255, 0.075), transparent 50%);--io-border-color: rgb(140, 140, 140);--io-border: var(--io-border-width) solid var(--io-border-color);--io-inset-border-color: rgb(140, 140, 140) var(--io-border-color) var(--io-border-color) rgb(140, 140, 140);--io-inset-border: var(--io-border-width) inset var(--io-border-color);--io-outset-border-color: var(--io-border-color) rgb(32, 32, 32) rgb(32, 32, 32) var(--io-border-color);--io-outset-border: var(--io-border-width) outset var(--io-border-color);--io-shadow: 2px 2px 5px rgba(0,0,0,0.2);--io-shadow-inset: 2px 2px 2px inset rgba(0,0,0,0.05);--io-shadow-outset: -1px -1px 2px inset rgba(0,0,0,0.1), 2px 2px 2px inset rgba(255,255,255,0.3);}</style>`}get light(){return html`<style>body {--io-background-color: rgb(245, 245, 245);--io-background-color-light: rgb(255, 255, 255);--io-background-color-dark: rgb(215, 215, 215);--io-background-color-field: rgb(235, 235, 235);--io-color: rgb(42, 42, 42);--io-color-error: rgb(225, 100, 100);--io-color-link: rgb(30, 180, 30);--io-color-focus: rgb(80, 210, 355);--io-color-field: rgb(0, 0, 0);--io-color-number: rgb(32, 164, 255);--io-color-string: rgb(240, 64, 22);--io-color-boolean: rgb(210, 90, 190);--io-gradient-button: linear-gradient(0deg, rgba(0, 0, 0, 0.15), transparent 75%), linear-gradient(180deg, rgba(255, 255, 255, 0.25), transparent 75%);--io-gradient-panel: linear-gradient(100deg, rgba(0, 0, 0, 0.15), transparent 75%), linear-gradient(280deg, rgba(255, 255, 255, 0.25), transparent 75%);--io-border-color: rgb(180, 180, 180);--io-border: var(--io-border-width) solid var(--io-border-color);--io-inset-border-color: rgb(220, 220, 220) var(--io-border-color) var(--io-border-color) rgb(220, 220, 220);--io-inset-border: var(--io-border-width) inset var(--io-border-color);--io-outset-border-color: var(--io-border-color) rgb(210, 210, 210) rgb(210, 210, 210) var(--io-border-color);--io-outset-border: var(--io-border-width) outset var(--io-border-color);--io-shadow: 2px 2px 5px rgba(0,0,0,0.2);--io-shadow-inset: 1px 1px 1px inset rgba(0,0,0,0.1);--io-shadow-outset: -1px -1px 1px inset rgba(0,0,0,0.2), 1px 1px 1px inset rgba(255,255,255,0.6);}</style>`}static get Properties(){return{theme:"light"}}constructor(e){super(e),this.styleElement=document.createElement("style"),this.styleElement.setAttribute("id","io-theme")}changed(){this.styleElement.innerHTML=this[this.theme].string}}IoTheme.Register();const IoThemeSingleton=new IoTheme;IoThemeSingleton.connect(),document.head.appendChild(IoThemeSingleton.styleElement);class Item{constructor(e){"object"!=typeof e||void 0===e.options&&void 0===e.action&&void 0===e.value?this.value=e:Object.assign(this,e),void 0===this.label&&(this.value instanceof Array?this.label=String(`${this.value.constructor.name} (${this.value.length})`):"object"==typeof this.value?this.label=String(`${this.value.constructor.name}`):void 0!==this.value?this.label=String(this.value):console.warn("Option must have label or value!"))}}class IoItem extends IoElement{static get Style(){return html`<style>:host {${IoThemeMixinSingleton.item};}:host {cursor: pointer;user-select: none;background-color: var(--io-background-color);color: var(--io-color);}:host:hover {background-color: var(--io-background-color-light);}:host:focus {text-overflow: inherit;border-color: var(--io-color-focus);outline: 0;}:host[aria-invalid] {text-decoration: underline;text-decoration-style: dashed;text-decoration-color: var(--io-color-error);border-color: var(--io-color-error);}:host[hidden] {display: none;}:host[selected] {color: var(--io-color-link);}</style>`}static get Attributes(){return{label:{notify:!0},hidden:Boolean,selected:Boolean,tabindex:0}}static get Properties(){return{value:void 0}}static get Listeners(){return{focus:"_onFocus"}}get textNode(){return this._flattenTextNode(),this._textNode.nodeValue}set textNode(e){this._flattenTextNode(),this._textNode.nodeValue!==String(e)&&(this._textNode.nodeValue=String(e))}_flattenTextNode(){if(0===this.childNodes.length&&this.appendChild(document.createTextNode("")),this._textNode=this.childNodes[0],this.childNodes.length>1){const e=this.textContent;for(let e=this.childNodes.length;e--;)0!==e&&this.removeChild(this.childNodes[e]);this._textNode.nodeValue=e}}constructor(e){super(e),this._textNode=document.createTextNode(""),this.appendChild(this._textNode)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("blur",this._onBlur),this.removeEventListener("keydown",this._onKeydown),this.removeEventListener("click",this._onClick)}_onFocus(){this.addEventListener("blur",this._onBlur),this.addEventListener("keydown",this._onKeydown),this.addEventListener("click",this._onClick)}_onBlur(){this.removeEventListener("blur",this._onBlur),this.removeEventListener("keydown",this._onKeydown),this.removeEventListener("click",this._onClick)}_onKeydown(e){13===e.which||32===e.which?(e.preventDefault(),this._onClick(e)):"ArrowLeft"===e.key?(e.preventDefault(),this.focusTo("left")):"ArrowUp"===e.key?(e.preventDefault(),this.focusTo("up")):"ArrowRight"===e.key?(e.preventDefault(),this.focusTo("right")):"ArrowDown"===e.key&&(e.preventDefault(),this.focusTo("down"))}_onClick(){this.dispatchEvent("item-clicked",{value:this.value,label:this.label},!0)}changed(){let e=String(this.value);this.value&&"object"==typeof this.value&&(e=`${this.value.constructor.name}`+(this.value instanceof Array?`(${this.value.length})`:"")),e=this.label||e,this.textNode=e,this.title=e}}IoItem.Register();class IoBoolean extends IoItem{static get Style(){return html`<style>:host {${IoThemeMixinSingleton.button}}:host:not([value]) {opacity: 0.75;}</style>`}static get Attributes(){return{role:"switch"}}static get Properties(){return{value:{type:Boolean,reflect:1},true:"true",false:"false",role:"switch"}}_onClick(){this.toggle()}toggle(){this.set("value",!this.value)}valueChanged(){this.setAttribute("value",Boolean(this.value))}changed(){this.setAttribute("aria-checked",String(!!this.value)),this.setAttribute("aria-invalid","boolean"!=typeof this.value&&"true"),this.textNode=this.value?this.true:this.false}}IoBoolean.Register();class IoButton extends IoItem{static get Style(){return html`<style>:host {${IoThemeMixinSingleton.button}}</style>`}static get Attributes(){return{label:"Button",role:"button"}}static get Properties(){return{action:Function,value:void 0}}_onClick(){"function"==typeof this.action&&this.action(this.value)}}IoButton.Register();class IoNumber extends IoItem{static get Style(){return html`<style>:host {${IoThemeMixinSingleton.field}}</style>`}static get Attributes(){return{role:"textbox",type:"number",pattern:'pattern="[0-9]*"',inputmode:"numeric",contenteditable:!0,spellcheck:!1}}static get Properties(){return{value:Number,conversion:1,step:.001,min:-1/0,max:1/0,strict:!0}}_onFocus(e){super._onFocus(e),this._textContentOnFocus=this.textNode}_onBlur(e){super._onBlur(e),this._textContentOnFocus!==this.textNode&&this._setFromTextNode(),this.scrollTop=0,this.scrollLeft=0}_onKeydown(e){const t=window.getSelection().getRangeAt(0),o=t.startOffset,i=t.endOffset,r=this.childNodes[0]?this.childNodes[0].length:0,s=t.startContainer===t.endContainer&&(t.startContainer===this.childNodes[0]||t.startContainer===this);13==e.which?(e.preventDefault(),this._setFromTextNode()):37==e.which?s&&o===i&&0===o&&(e.preventDefault(),this.focusTo("left")):38==e.which?s&&o===i&&0===o&&(e.preventDefault(),this.focusTo("up")):39==e.which?s&&o===i&&o===r&&(e.preventDefault(),this.focusTo("right")):40==e.which&&s&&o===i&&o===r&&(e.preventDefault(),this.focusTo("down"))}_setFromTextNode(){let e=this.textNode,t=Math.round(Number(e)/this.step)*this.step/this.conversion;this.strict&&(t=Math.min(this.max,Math.max(this.min,t))),isNaN(t)?this.textNode="NaN":this.set("value",t)}changed(){let e,t=this.value;if("number"!=typeof t||isNaN(t))e="NaN";else{t*=this.conversion;let o=-Math.round(Math.log(this.step)/Math.LN10);o=Math.max(0,Math.min(100,o)),t=t.toFixed(o),e=Number(String(t))}this.textNode=e,this.setAttribute("aria-invalid",!("number"==typeof this.value&&!isNaN(this.value))&&"true")}}IoNumber.Register();class IoSlider extends IoElement{static get Style(){return html`<style>:host {display: flex;align-self: stretch;justify-self: stretch;}:host > io-number {flex: 0 0 auto;margin-right: var(--io-spacing);}:host > io-slider-knob {flex: 1 1 4.5em;}</style>`}static get Properties(){return{value:0,step:.001,min:0,max:1}}_onValueSet(e){this.value=e.detail.value,this.dispatchEvent("value-set",e.detail,!1)}changed(){this.template([["io-number",{id:"number",value:this.value,step:this.step,min:this.min,max:this.max,label:this.label,title:this.title,"on-value-set":this._onValueSet}],["io-slider-knob",{id:"slider",value:this.value,step:this.step,minValue:this.min,maxValue:this.max,label:this.label,title:this.title,"on-value-set":this._onValueSet}]])}}class IoSliderKnob extends IoGl{static get Style(){return html`<style>:host {cursor: ew-resize;border: var(--io-inset-border);border-radius: var(--io-border-radius);border-color: var(--io-inset-border-color);min-height: 1.2em;align-self: stretch;justify-self: stretch}:host[aria-invalid] {outline: 1px solid var(--io-color-focus);}:host:focus {outline: 1px solid var(--io-color-focus);}</style>`}static get Attributes(){return{role:"slider",tabindex:0}}static get Properties(){return{value:0,step:.01,minValue:0,maxValue:1e3,startColor:[.3,.9,1,1],endColor:[.9,1,.5,1],lineColor:[.5,.5,.5,1],bg:[.2,.2,.2,1],snapWidth:2,slotWidth:2,handleWidth:4}}static get Listeners(){return{touchstart:"_onTouchstart",mousedown:"_onMousedown",keydown:"_onKeydown"}}_onTouchstart(e){this.addEventListener("touchmove",this._onTouchmove),this.addEventListener("touchend",this._onTouchend),this._onPointerdown(e)}_onTouchmove(e){this._onPointermove(e)}_onTouchend(){this.removeEventListener("touchmove",this._onTouchmove),this.removeEventListener("touchend",this._onTouchend)}_onMousedown(e){e.preventDefault(),this.focus(),window.addEventListener("mousemove",this._onMousemove),window.addEventListener("mouseup",this._onMouseup),this._onPointerdown(e)}_onMousemove(e){this._onPointermove(e)}_onMouseup(){window.removeEventListener("mousemove",this._onMousemove),window.removeEventListener("mouseup",this._onMouseup)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("mousemove",this._onMousemove),window.removeEventListener("mouseup",this._onMouseup)}_onPointerdown(e){const t=e.changedTouches?e.changedTouches[0]:e;this._x=t.clientX,this._y=t.clientY,this._active=-1}_onPointermove(e){const t=e.changedTouches?e.changedTouches[0]:e,o=Math.abs(this._x-t.clientX),i=Math.abs(this._y-t.clientY);if(-1===this._active&&o>5&&(this._active=o>i&&i<20?1:0),1!==this._active)return;if(!e.cancelable)return;e.preventDefault(),this.focus();const r=this.getBoundingClientRect(),s=(t.clientX-r.x)/r.width,n=Math.max(0,Math.min(1,s));let a=(this.maxValue-this.minValue)*n;a=this.minValue+Math.round(a/this.step)*this.step,a=Math.min(this.maxValue,Math.max(this.minValue,a));let l=-Math.round(Math.log(this.step)/Math.LN10);l=Math.max(0,Math.min(100,l)),a=Number(a.toFixed(l)),this.set("value",a)}_onKeydown(e){37==e.which?(e.preventDefault(),e.shiftKey?this._moveSliderByKey("decrease"):this.focusTo("left")):38==e.which?(e.preventDefault(),e.shiftKey?this._moveSliderByKey("decrease"):this.focusTo("up")):39==e.which?(e.preventDefault(),e.shiftKey?this._moveSliderByKey("increase"):this.focusTo("right")):40==e.which?(e.preventDefault(),e.shiftKey?this._moveSliderByKey("increase"):this.focusTo("down")):33==e.which?(e.preventDefault(),this._moveSliderByKey("increase")):34==e.which?(e.preventDefault(),this._moveSliderByKey("decrease")):36==e.which?(e.preventDefault(),this._moveSliderByKey("min")):35==e.which&&(e.preventDefault(),this._moveSliderByKey("max"))}_moveSliderByKey(e){let t=this.value;switch(e){case"increase":t+=this.step;break;case"decrease":t-=this.step;break;case"min":t=this.minValue;break;case"max":t=this.maxValue}t=Math.min(this.maxValue,Math.max(this.minValue,t));let o=-Math.round(Math.log(this.step)/Math.LN10);o=Math.max(0,Math.min(100,o)),t=Number(t.toFixed(o)),this.set("value",t)}changed(){super.changed(),this.setAttribute("aria-invalid",!!isNaN(this.value)&&"true"),this.setAttribute("aria-valuenow",isNaN(this.value)?0:this.value),this.setAttribute("aria-valuemin",this.minValue),this.setAttribute("aria-valuemax",this.maxValue)}static get Frag(){return"\n    #extension GL_OES_standard_derivatives : enable\n\n    varying vec2 vUv;\n\n    void main(void) {\n\n      vec4 finalColor = uBg;\n\n      float _range = uMaxValue - uMinValue;\n      float _progress = (uValue - uMinValue) / _range;\n      float _value = mix(uMinValue, uMaxValue, vUv.x);\n      float _stepRange = uSize.x / (_range / uStep);\n\n      if (_stepRange > uSnapWidth * 2.0) {\n        float res = _value / uStep;\n        float line = abs(fract(res - 0.5) - 0.5) / abs(dFdx(res)) / uSnapWidth;\n        finalColor = mix(finalColor, uLineColor, 1.0 - min(line, 1.0));\n      }\n\n      float slot = (abs(0.5 - vUv.y) * 2.0) * uSize.y;\n      slot = (1.0 - slot) + uSlotWidth;\n      slot = clamp(slot, 0.0, 1.0);\n      vec4 slotColor = mix(uStartColor, uEndColor, vUv.x);\n      float progress = (vUv.x - _progress) * uSize.x;\n      progress = clamp(progress, 0.0, 1.0);\n      slotColor = mix(slotColor, uLineColor, progress);\n\n      float handle = abs(vUv.x - _progress) * uSize.x;\n      handle = (1.0 - handle) + uHandleWidth;\n      handle = clamp(handle, 0.0, 1.0);\n\n      finalColor = mix(finalColor, slotColor, slot);\n      finalColor = mix(finalColor, mix(uStartColor, uEndColor, _progress), handle);\n      gl_FragColor = finalColor;\n    }"}}IoSliderKnob.Register(),IoSlider.Register();class IoString extends IoItem{static get Style(){return html`<style>:host {${IoThemeMixinSingleton.field}}</style>`}static get Attributes(){return{role:"textbox",contenteditable:!0}}static get Properties(){return{value:String}}_setFromTextNode(){const e=this.textNode;"string"!=typeof this.value&&e===String(this.value)||this.set("value",e)}_onBlur(e){super._onBlur(e),this.removeEventListener("blur",this._onBlur),this.removeEventListener("keydown",this._onKeydown),this._setFromTextNode(),this.scrollTop=0,this.scrollLeft=0}_onKeydown(e){const t=window.getSelection().getRangeAt(0),o=t.startOffset,i=t.endOffset,r=this.childNodes[0]?this.childNodes[0].length:0,s=t.startContainer===t.endContainer&&(t.startContainer===this.childNodes[0]||t.startContainer===this);13==e.which?(e.preventDefault(),this._setFromTextNode()):37==e.which?s&&o===i&&0===o&&(e.preventDefault(),this.focusTo("left")):38==e.which?s&&o===i&&0===o&&(e.preventDefault(),this.focusTo("up")):39==e.which?s&&o===i&&o===r&&(e.preventDefault(),this.focusTo("right")):40==e.which&&s&&o===i&&o===r&&(e.preventDefault(),this.focusTo("down"))}changed(){this.textNode=String(this.value).replace(new RegExp(" ","g")," "),this.setAttribute("aria-invalid","string"!=typeof this.value&&"true")}}IoString.Register();class IoSwitch extends IoButton{static get Style(){return html`<style>:host {--io-switch-size: 1.375em;text-align: center;position: relative;border: var(--io-inset-border);border-color: var(--io-inset-border-color);color: var(--io-color-field);background-image: none;background-color: var(--io-background-color-dark);box-shadow: var(--io-shadow-inset);padding: 0;margin: var(--io-spacing);width: 3.5em;height: 1.375em;height: var(--io-switch-size);border-radius: var(--io-switch-size);transition: background-color 0.4s;}:host:focus {outline: none;border-color: var(--io-color-focus);}:host:hover,:host[value] {background-color: var(--io-background-color);}:host:not([value]) {opacity: 0.75;}:host:after {display: inline-block;position: absolute;content: '';top: 0;left: 0;height: calc(var(--io-switch-size) - calc(2 * var(--io-border-width)));width: calc(var(--io-switch-size) - calc(2 * var(--io-border-width)));background-color: var(--io-background-color-dark);border: var(--io-outset-border);border-color: var(--io-outset-border-color);border-radius: var(--io-switch-size);transition-timing-function: ease-in-out;transition: left 0.25s;}:host[value]:after {background-color: rgba(80, 210, 355, 0.75);left: calc(100% - var(--io-switch-size));}:host[aria-invalid] > div:after {background-color: var(--io-color-error);}</style>`}static get Attributes(){return{role:"switch"}}static get Properties(){return{value:{type:Boolean,reflect:1}}}constructor(e){super(e),this.__properties.action.value=this.toggle}toggle(){this.set("value",!this.value)}changed(){this.setAttribute("aria-checked",String(this.value)),this.setAttribute("aria-invalid","boolean"!=typeof this.value&&"true")}}IoSwitch.Register();export{IoBoolean,IoButton,IoItem,IoNumber,IoSlider,IoString,IoSwitch,IoTheme,IoThemeMixinSingleton,Item};