<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-selector/iron-selector.html">

<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icons/image-icons.html">
<link rel="import" href="../iron-icons/av-icons.html">

<link rel="import" href="../three-js/three-js.html">

<!-- <link rel="import" href="icons/three-editor-icons.html"> -->

<link rel="import" href="../io-help/io-help.html">
<link rel="import" href="../io-help/io-help-line.html">
<link rel="import" href="../io-inspector/io-inspector.html">

<link rel="import" href="../three-viewport/three-viewport.html">

<link rel="import" href="../ree.js/src/ree.html">

<link rel="import" href="three-editor-viewport.html">
<link rel="import" href="three-editor-button.html">
<link rel="import" href="_io-config.html">

<!--
Three.js editor.

@demo demo/index.html Basic Demo
-->
<dom-module id="three-editor">
  <link rel="import" type="css" href="three-editor.css">
  <template>
    <div id="header"></div>
    <div id="middle">
      <div id="leftsidebar">
        <three-editor-button true="av:stop" false="av:play-arrow" value="{{playing}}"></three-editor-button>
        <iron-selector selected="{{controlSelector}}" attr-for-selected="value">
          <three-editor-icon icon="three:move" value="transform:translate"></three-editor-icon>
          <three-editor-icon icon="three:rotate" value="transform:rotate"></three-editor-icon>
          <three-editor-icon icon="three:scale" value="transform:scale"></three-editor-icon>
          <three-editor-icon icon="three:geometry-cube" value="sphere"></three-editor-icon>
          <three-editor-icon icon="create" value="line"></three-editor-icon>
        </iron-selector>
      </div>
      <div id="center">
        <three-editor-viewport
            id="viewport"
            scene="{{scene}}"
            controls="{{controls}}"
            cameras="{{cameras}}"
            playing="{{playing}}">
        </three-editor-viewport>
      </div>
      <div id="rightsidebar">
        <io-inspector id="inspector"></io-inspector>
      </div>
    </div>
    <io-help-line id="footer"></io-help-line>
  </template>
</dom-module>
<script>
(function () {

  var config = new REE.ConfigState({uuid: 'config-uuid'});

  var scene = new REE.SceneState({uuid: 'config-uuid'});

  var cameras = new REE.CamerasState({uuid: 'cameras-uuid'});

  var controls = new REE.ControlsState({
    'scene': scene,
    'snapDistance': [config, 'gridSize'],
    'snapAngle': [config, 'snapAngle']
  });

  var grid = new REE.GridHelper({
    'showAxis': [config, 'showAxis'],
    'axisSize': [config, 'axisSize'],
    'showGrid': [config, 'showGrid'],
    'gridSize': [config, 'gridSize'],
    'gridWidth': [config, 'gridWidth'],
    'gridColor1': [config, 'gridColor1'],
    'gridColor2': [config, 'gridColor2']
  });
  scene._helpers.add(grid);

  var compass = new REE.CompassHelper({
    'size': [config, 'compassSize'],
    'visible': [config, 'showCompass']
  });
  scene._helpers.add(compass);

  Polymer({
    is: 'three-editor',
    properties: {
      config: {
        value: config,
        type: THREE.ConfigState
      },
      scene: {
        value: scene,
        type: THREE.SceneState
      },
      cameras: {
        value: cameras,
        type: REE.CamerasState
      },
      controls: {
        value: controls,
        type: REE.ControlsState
      },
      controlSelector: {
        type: String,
        notify: true
      },
      playing: {
        value: false,
        type: Boolean,
        reflectToAttribute: true
      }
    },
    ready: function () {
      config.bindProperty('clearColor', this.$.viewport, 'clearColor');
      config.bindProperty('showHelpers', this.$.viewport, 'showHelpers');

      controls.bindProperty('selector', this, 'controlSelector');

      this.$.inspector.value = config;

      controls.addEventListener('*.selection-changed', function(event) {
        this.$.inspector.value = event.value.objects[0] || config;
      }.bind(this));

      controls.addEventListener('control-changed', function(event) {
        this.$.inspector.value = event.value || config;
      }.bind(this));

      controls.addEventListener('*render', function(event) {
        this.$.viewport.renderAction(event);
      }.bind(this));

      config.addEventListener('*', function() {
        this.$.viewport.render();
      }.bind(this));


    }
  });
}());
</script>
