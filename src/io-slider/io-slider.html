<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../io-styles/io-styles.html">
<link rel="import" href="../io-input/io-input.html">

<!--
Custom HTML element that can be used as input/output for number variables.

Example:

    <io-slider value="0" min="0" max="1" step="0.1" editable></io-slider>

@demo demo/index.html Basic Demo
-->

<dom-module id="io-slider">
  <style>
  :host {
    display: flex;
    display: -webkit-flex;
  }
  :host(.focused) {
    /*@apply(--io-focused);*/
  }
  :host([disabled]) {
    /*@apply(--io-disabled);*/
  }
  :host([invalid]) {
    /*@apply(--io-invalid);*/
    /* TODO */
  }
  #input{
    /*width: 2em;*/
  }
  #bar {
    cursor: ew-resize;
    display: block;
    flex: 1;
    -webkit-flex: 1;
    background: rgb(59, 153, 252);
  }
  </style>
  <template>
    <io-input id="input" type="float" value="{{value}}"></io-input>
    <div id="bar" tabindex="0">&nbsp;</div>
  </template>
</dom-module>
<script>
(function() {
  // var rect, value, rootStyle, rootWidth;


  Polymer({
    is: 'io-slider',
    properties: {
      /**
       * Element's value.
       */
      value: {
        notify: true,
        observer: '_valueChangedJob'
      },
      /**
       * Element's immediate value.
       */
      immediatevalue: {
        notify: true,
        observer: '_immediatevalueChanged'
      },
      /**
       * Desables the element.
       */
      disabled: {
        type: Boolean,
        observer: '_disabledChanged',
        reflectToAttribute: true
      },
      /**
       * True when element value is invalid.
       */
      invalid: {
        value: false,
        type: Boolean,
        notify: true,
        reflectToAttribute: true
      },
      /**
       * Minimum value.
       */
      min: {
        value: 0,
        type: Number,
        observer: '_valueChangedJob'
      },
      /**
       * Maximum value.
       */
      max: {
        value: 1,
        type: Number,
        observer: '_valueChangedJob'
      },
      /**
       * Step.
       */
      step: {
        value: 0.1,
        type: Number,
        observer: '_valueChangedJob'
      }
    },
    listeners: {
      'click': 'focus'
    },
    hostAttributes: {
      role: 'input'
    },
    ready: function() {
      if (this.value === undefined) this._valueChangedJob();
    },
    /**
     * Used to set value by user action.
     * Fires non-bubbling event io-value-set
     * @param {*} value new value to be set.
     */
    setValue: function(value) {
      if (this.disabled) return;
      if (value === this.value) return;
      var oldValue = this.value;
      this.value = value;
      /**
       * This event is fired when value is set by user action.
       * This is a non-bubbling event.
       * @event io-value-set
       * @param {Object} detail value change data
       * @param {Object} detail.value new value
       * @param {Object} detail.oldValue old value
       */
      this.fire('io-value-set', {value: value, oldValue: oldValue}, {bubbles: false});
    },
    _disabledChanged: function() {
      this.$.input.disabled = this.disabled;
      if (this.disabled) {
        this.setAttribute('aria-disabled', '');
      } else {
        this.removeAttribute('aria-disabled');
      }
    },
    _valueChanged: function() {
      this.immediatevalue = this.value;
    },
    _valueChangedJob: function() {
      this.debounce('io-slider-value-change', this._valueChanged);
    },
    _immediatevalueChanged: function() {
      if (document.activeElement !== this.$.input) {
        this.value = this.immediatevalue;
      }
    },
    _updateImmediateValue: function() {
      // TODO
    },
    _updateInputValue: function () {
      // TODO
    },
    _onKeyDown: function(event) {
      this.debounce('io-slider-resize', this._updateImmediateValue, 1);
    },
    _onFocus: function() {
      this.toggleClass('focused', true);
      this._updateInputWidth();
      this._updateInputValue();
    },
    _onBlur: function() {
      this.toggleClass('focused', false);
      this.setValue(this.immediatevalue);
      this.scrollLeft = 0;
    }

  });
}());
</script>
